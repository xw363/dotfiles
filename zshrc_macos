# macOS-specific settings
# Set locale
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8

# Set path
export PATH="/usr/local/sbin:$PATH"

# Initialize conda
# >>> conda initialize >>>
# !! Contents within this block are managed by 'conda init' !!
__conda_setup="$('/Users/xiaojunwu/opt/miniconda3/bin/conda' 'shell.zsh' 'hook' 2> /dev/null)"
if [ $? -eq 0 ]; then
    eval "$__conda_setup"
else
    if [ -f "/Users/xiaojunwu/opt/miniconda3/etc/profile.d/conda.sh" ]; then
        . "/Users/xiaojunwu/opt/miniconda3/etc/profile.d/conda.sh"
    else
        export PATH="/Users/xiaojunwu/opt/miniconda3/bin:$PATH"
    fi
fi
unset __conda_setup
# <<< conda initialize <<<

# SRA toolkit
export PATH=/Users/xiaojunwu/edirect:${PATH}
export PATH=$HOME/opt/sratoolkit.3.1.1-mac-x86_64/bin:$PATH

# radian console for R
alias r="radian"

# vi-mode cursor shapes and history search with arrow keys in iTerm2
if [[ -v TERM_PROGRAM && $TERM_PROGRAM == "iTerm.app" ]]; then
    # cursor shapes
    function zle-keymap-select zle-line-init zle-line-finish {
        case $KEYMAP in
          vicmd)      print -n -- "\E]50;CursorShape=0\C-G";; # block cursor
          viins|main) print -n -- "\E]50;CursorShape=1\C-G";; # line cursor
        esac

        zle reset-prompt
        zle -R
    }

    zle -N zle-line-init
    zle -N zle-line-finish
    zle -N zle-keymap-select

    # history search in insert mode
    autoload -Uz history-search-end

    zle -N history-beginning-search-backward-end history-search-end
    zle -N history-beginning-search-forward-end history-search-end

    bindkey -M viins '^[[A' history-beginning-search-backward-end \
                     '^[OA' history-beginning-search-backward-end \
                     '^[[B' history-beginning-search-forward-end \
                     '^[OB' history-beginning-search-forward-end
fi

# iTerm 2 integration
test -e "${HOME}/.iterm2_shell_integration.zsh" && source "${HOME}/.iterm2_shell_integration.zsh"
